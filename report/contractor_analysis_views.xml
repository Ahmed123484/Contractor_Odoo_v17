<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Enhanced Analysis Report Tree View -->
        <record id="view_contractor_statement_analysis_tree" model="ir.ui.view">
            <field name="name">contractor.statement.analysis.report.tree</field>
            <field name="model">contractor.statement.analysis.report</field>
            <field name="arch" type="xml">
                <tree string="Contractor Statement Analysis" create="false" decoration-success="state=='paid'" decoration-warning="state=='approved'" decoration-info="state=='confirmed'" decoration-muted="state=='draft'">
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="work_type_id"/>
                    <field name="contractor_id"/>
                    <field name="contractor_type"/>
                    <field name="statement_date"/>
                    <field name="product_id"/>
                    <field name="contract_qty" sum="Total Contract Qty"/>
                    <field name="current_qty" sum="Total Current Qty"/>
                    <field name="total_qty" sum="Total Qty"/>
                    <field name="progress_percent" avg="Average Progress" widget="percentage"/>
                    <field name="current_value" sum="Total Current Value" widget="monetary"/>
                    <field name="total_value" sum="Total Value" widget="monetary"/>
                    <field name="gross_value" sum="Total Gross Value" widget="monetary"/>
                    <field name="tax_amount" sum="Total Tax" widget="monetary"/>
                    <field name="total_deductions" sum="Total Deductions" widget="monetary"/>
                    <field name="net_payable" sum="Total Net Payable" widget="monetary"/>
                    <field name="efficiency_ratio" avg="Avg Efficiency" widget="percentage"/>
                    <field name="state" widget="badge"/>
                    <field name="currency_id" invisible="1"/>
                </tree>
            </field>
        </record>
        
        <!-- Enhanced Analysis Report Search View -->
        <record id="view_contractor_statement_analysis_search" model="ir.ui.view">
            <field name="name">contractor.statement.analysis.report.search</field>
            <field name="model">contractor.statement.analysis.report</field>
            <field name="arch" type="xml">
                <search string="Contractor Statement Analysis">
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="work_type_id"/>
                    <field name="contractor_id"/>
                    <field name="product_id"/>
                    <field name="statement_date"/>
                    
                    <!-- Status Filters -->
                    <filter string="Main Contractor" name="main_contractor" domain="[('contractor_type', '=', 'main')]"/>
                    <filter string="Sub Contractor" name="sub_contractor" domain="[('contractor_type', '=', 'sub')]"/>
                    
                    <separator/>
                    <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="Confirmed" name="confirmed" domain="[('state', '=', 'confirmed')]"/>
                    <filter string="Approved" name="approved" domain="[('state', '=', 'approved')]"/>
                    <filter string="Paid" name="paid" domain="[('state', '=', 'paid')]"/>
                    
                    <separator/>
                    <!-- Performance Filters -->
                    <filter string="High Value (>100k)" name="high_value" domain="[('net_payable', '>', 100000)]"/>
                    <filter string="Low Progress (&lt;50%)" name="low_progress" domain="[('progress_percent', '&lt;', 50)]"/>
                    <filter string="High Progress (>80%)" name="high_progress" domain="[('progress_percent', '>', 80)]"/>
                    <filter string="Efficient Projects" name="efficient" domain="[('efficiency_ratio', '>', 0.8)]"/>
                    
                    <separator/>
                    <!-- Date Filters -->
                    <filter string="Today" name="today" domain="[('statement_date', '=', context_today())]"/>
                    <filter string="This Week" name="this_week" domain="[('statement_date', '>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <filter string="This Month" name="this_month" domain="[('statement_date', '>=', context_today().strftime('%Y-%m-01'))]" />
                    <filter string="This Quarter" name="this_quarter" domain="[('statement_date', '>=', (context_today() - datetime.timedelta(days=90)).strftime('%Y-%m-%d'))]"/>
                    <filter string="This Year" name="this_year" domain="[('statement_date', '>=', context_today().strftime('%Y-01-01')), ('statement_date', '&lt;=', context_today().strftime('%Y-12-31'))]"/>
                    <filter string="Last Year" name="last_year" domain="[('statement_date', '>=', (context_today() - datetime.timedelta(days=365)).strftime('%Y-01-01')), ('statement_date', '&lt;=', (context_today() - datetime.timedelta(days=365)).strftime('%Y-12-31'))]"/>
                    
                    <separator/>
                    <!-- Value Range Filters -->
                    <filter string="Small Projects (&lt;50k)" name="small_projects" domain="[('net_payable', '&lt;', 50000)]"/>
                    <filter string="Medium Projects (50k-200k)" name="medium_projects" domain="[('net_payable', '>=', 50000), ('net_payable', '&lt;=', 200000)]"/>
                    <filter string="Large Projects (>200k)" name="large_projects" domain="[('net_payable', '>', 200000)]"/>
                    
                    <group expand="0" string="Group By">
                        <filter string="Project" name="group_by_project" context="{'group_by': 'project_id'}"/>
                        <filter string="Work Type" name="group_by_work_type" context="{'group_by': 'work_type_id'}"/>
                        <filter string="Contractor" name="group_by_contractor" context="{'group_by': 'contractor_id'}"/>
                        <filter string="Contractor Type" name="group_by_contractor_type" context="{'group_by': 'contractor_type'}"/>
                        <filter string="Product" name="group_by_product" context="{'group_by': 'product_id'}"/>
                        <filter string="Status" name="group_by_state" context="{'group_by': 'state'}"/>
                        <filter string="Month" name="group_by_month" context="{'group_by': 'statement_date:month'}"/>
                        <filter string="Quarter" name="group_by_quarter" context="{'group_by': 'statement_date:quarter'}"/>
                        <filter string="Year" name="group_by_year" context="{'group_by': 'statement_date:year'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <!-- Enhanced Analysis Report Graph View -->
        <record id="view_contractor_statement_analysis_graph" model="ir.ui.view">
            <field name="name">contractor.statement.analysis.report.graph</field>
            <field name="model">contractor.statement.analysis.report</field>
            <field name="arch" type="xml">
                <graph string="Contractor Statement Analysis" type="bar" stacked="True">
                    <field name="project_id"/>
                    <field name="contractor_type" type="col"/>
                    <field name="net_payable" type="measure"/>
                    <field name="gross_value" type="measure"/>
                    <field name="total_deductions" type="measure"/>
                    <field name="progress_percent" type="measure"/>
                </graph>
            </field>
        </record>
        
        <!-- Enhanced Analysis Report Pivot View -->
        <record id="view_contractor_statement_analysis_pivot" model="ir.ui.view">
            <field name="name">contractor.statement.analysis.report.pivot</field>
            <field name="model">contractor.statement.analysis.report</field>
            <field name="arch" type="xml">
                <pivot string="Contractor Statement Analysis" display_quantity="true" sample="1">
                    <field name="project_id" type="row"/>
                    <field name="contractor_id" type="row"/>
                    <field name="work_type_id" type="col"/>
                    <field name="contractor_type" type="col"/>
                    <field name="net_payable" type="measure"/>
                    <field name="gross_value" type="measure"/>
                    <field name="total_deductions" type="measure"/>
                    <field name="progress_percent" type="measure"/>
                    <field name="efficiency_ratio" type="measure"/>
                </pivot>
            </field>
        </record>
        
        <!-- Calendar View for Statement Dates - SIMPLIFIED -->
        <record id="view_contractor_statement_analysis_calendar" model="ir.ui.view">
            <field name="name">contractor.statement.analysis.report.calendar</field>
            <field name="model">contractor.statement.analysis.report</field>
            <field name="arch" type="xml">
                <calendar string="Statement Calendar" date_start="statement_date">
                    <field name="name"/>
                    <field name="contractor_id"/>
                    <field name="net_payable"/>
                    <field name="state"/>
                </calendar>
            </field>
        </record>
        
        <!-- Kanban View for Visual Overview -->
        <record id="view_contractor_statement_analysis_kanban" model="ir.ui.view">
            <field name="name">contractor.statement.analysis.report.kanban</field>
            <field name="model">contractor.statement.analysis.report</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile_view" sample="1">
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="contractor_id"/>
                    <field name="contractor_type"/>
                    <field name="net_payable"/>
                    <field name="progress_percent"/>
                    <field name="state"/>
                    <field name="statement_date"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="o_kanban_card o_kanban_global_click">
                                <div class="o_kanban_record_top mb16">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title"><field name="name"/></strong>
                                        <br/>
                                        <small class="o_kanban_record_subtitle text-muted">
                                            <field name="project_id"/> • <field name="contractor_id"/>
                                        </small>
                                    </div>
                                    <div class="o_kanban_record_top">
                                        <div class="o_dropdown_kanban dropdown">
                                            <a class="dropdown-toggle o-no-caret btn" data-bs-toggle="dropdown" href="#" role="button" aria-label="Dropdown menu" title="Dropdown menu">
                                                <span class="fa fa-ellipsis-vertical"/>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="contractor_type" widget="badge"/>
                                    <field name="state" widget="badge"/>
                                    <div class="mt8">
                                        <strong>Net Payable: <field name="net_payable" widget="monetary"/></strong>
                                    </div>
                                    <div class="mt4">
                                        Progress: <field name="progress_percent" widget="percentage"/>
                                    </div>
                                    <div class="mt4">
                                        Date: <field name="statement_date"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- Enhanced Analysis Report Action -->
        <record id="action_contractor_statement_analysis_report" model="ir.actions.act_window">
            <field name="name">Contractor Statement Analysis</field>
            <field name="res_model">contractor.statement.analysis.report</field>
            <field name="view_mode">kanban,pivot,graph,tree</field>
            <field name="search_view_id" ref="view_contractor_statement_analysis_search"/>
            <field name="context">{'search_default_group_by_project': 1, 'search_default_this_month': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No contractor statement data available yet!
                </p>
                <p>
                    This report provides comprehensive analysis of your contractor statements including:
                    <ul>
                        <li>Financial performance tracking</li>
                        <li>Progress monitoring</li>
                        <li>Payment analysis</li>
                        <li>Contractor efficiency metrics</li>
                        <li>Project comparisons</li>
                    </ul>
                </p>
            </field>
        </record>
        
        <!-- Dashboard Action -->
        <record id="action_contractor_statement_dashboard" model="ir.actions.act_window">
            <field name="name">Contractor Dashboard</field>
            <field name="res_model">contractor.statement.analysis.report</field>
            <field name="view_mode">pivot,graph,kanban</field>
            <field name="search_view_id" ref="view_contractor_statement_analysis_search"/>
            <field name="context">{'search_default_group_by_project': 1, 'search_default_this_month': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Welcome to your Contractor Dashboard!
                </p>
            </field>
        </record>
        
        <!-- Menu Updates -->
        <menuitem id="menu_contractor_statement_analysis_report" 
                  name="Statement Analysis" 
                  parent="contractor_statement_main_menu" 
                  action="action_contractor_statement_analysis_report" 
                  sequence="20"/>
                  
        <menuitem id="menu_contractor_statement_dashboard" 
                  name="Dashboard" 
                  parent="contractor_statement_main_menu" 
                  action="action_contractor_statement_dashboard" 
                  sequence="15"/>
    </data>
</odoo>
